<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Earthquake Assistant - Guatemala</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
            
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            min-height: 100vh;
            display: flex;  
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            width: 100%;
            max-width: 500px;
            background-color: white;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            overflow: hidden;
            height: 80vh;
            display: flex;
            flex-direction: column;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #b21f1f, #1a2a6c);
            color: white;
            padding: 20px;
            text-align: center;
            position: relative;
        }
        
        .chat-header h1 {
            font-size: 1.5rem;
            margin-bottom: 5px;
        }
        
        .chat-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }
        
        .status-indicator {
            display: inline-block;
            width: 8px;
            height: 8px;
            background-color: #4CAF50;
            border-radius: 50%;
            margin-left: 5px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .bot-avatar {
            width: 60px;
            height: 60px;
            background-color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin: 0 auto 10px;
            color: #b21f1f;
            font-size: 1.8rem;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .chat-container {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background-color: #f9f9f9;
            display: flex;
            flex-direction: column;
        }
        
        .message {
            max-width: 80%;
            padding: 12px 16px;
            margin-bottom: 15px;
            border-radius: 18px;
            position: relative;
            animation: fadeIn 0.3s ease;
            line-height: 1.4;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .bot-message {
            background-color: #e6e6e6;
            color: #333;
            border-bottom-left-radius: 5px;
            align-self: flex-start;
        }
        
        .user-message {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            color: white;
            border-bottom-right-radius: 5px;
            margin-left: auto;
        }
        
        .chat-input {
            display: flex;
            padding: 15px;
            background-color: white;
            border-top: 1px solid #eee;
        }
        
        .chat-input input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: 30px;
            outline: none;
            font-size: 1rem;
            transition: all 0.3s;
        }
        
        .chat-input input:focus {
            border-color: #b21f1f;
            box-shadow: 0 0 0 2px rgba(178, 31, 31, 0.2);
        }
        
        .chat-input button {
            background: linear-gradient(135deg, #b21f1f, #1a2a6c);
            color: white;
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            margin-left: 10px;
            cursor: pointer;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
        }
        
        .chat-input button:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(178, 31, 31, 0.4);
        }
        
        .chat-input button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
        
        .typing-indicator {
            display: flex;
            padding: 10px 16px;
            background-color: #e6e6e6;
            border-radius: 18px;
            border-bottom-left-radius: 5px;
            width: fit-content;
            margin-bottom: 15px;
        }
        
        .typing-indicator span {
            height: 8px;
            width: 8px;
            background-color: #999;
            border-radius: 50%;
            display: inline-block;
            margin: 0 2px;
            animation: typing 1s infinite ease-in-out;
        }
        
        .typing-indicator span:nth-child(1) {
            animation-delay: 0.2s;
        }
        
        .typing-indicator span:nth-child(2) {
            animation-delay: 0.4s;
        }
        
        .typing-indicator span:nth-child(3) {
            animation-delay: 0.6s;
        }
        
        @keyframes typing {
            0%, 100% { transform: translateY(0); }
            50% { transform: translateY(-5px); }
        }
        
        .suggestions {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            padding: 15px;
            background-color: #f0f0f0;
            border-top: 1px solid #ddd;
        }
        
        .suggestion {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f);
            color: white;
            border: none;
            border-radius: 20px;
            padding: 8px 15px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .suggestion:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        }
        
        .timestamp {
            font-size: 0.7rem;
            opacity: 0.7;
            margin-top: 5px;
            text-align: right;
        }
        
        .emergency-info {
            background-color: #ffebee;
            border-left: 4px solid #b21f1f;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .info-title {
            font-weight: bold;
            color: #b21f1f;
            margin-bottom: 5px;
        }
        
        .definition {
            background-color: #e3f2fd;
            border-left: 4px solid #1a2a6c;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 0.9rem;
        }
        
        .definition-title {
            font-weight: bold;
            color: #1a2a6c;
            margin-bottom: 5px;
        }
        
        .error-message {
            background-color: #ffebee;
            border-left: 4px solid #d32f2f;
            padding: 10px 15px;
            margin: 10px 0;
            border-radius: 5px;
            font-size: 0.9rem;
            color: #d32f2f;
        }
        
        @media (max-width: 600px) {
            .container {
                height: 90vh;
            }
            
            .message {
                max-width: 90%;
            }
            
            .suggestions {
                gap: 8px;
            }
            
            .suggestion {
                font-size: 0.8rem;
                padding: 6px 12px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="chat-header">
            <div class="bot-avatar">üåã</div>
            <h1>AI Earthquake Assistant - Guatemala <span class="status-indicator" title="AI Connected"></span></h1>
            <p>Powered by OpenAI - Specialized in earthquake information</p>
        </div>
        
        <div class="chat-container" id="chatContainer">
            <div class="message bot-message">
                Hello! I'm your AI earthquake assistant specialized in Guatemala. I can provide detailed information about earthquakes, safety measures, historical events, and more.
                <div class="emergency-info">
                    <div class="info-title">‚ö†Ô∏è EMERGENCY PROTOCOL:</div>
                    If you're experiencing an earthquake: DROP to the ground, take COVER under sturdy furniture, and HOLD ON until shaking stops. Stay away from windows and falling objects.
                </div>
                <div class="timestamp" id="initialTime"></div>
            </div>
        </div>
        
        <div class="suggestions">
            <div class="suggestion" data-msg="What was the strongest earthquake in Guatemala's history?">Strongest Earthquake</div>
            <div class="suggestion" data-msg="What should I include in an earthquake emergency kit?">Emergency Kit</div>
            <div class="suggestion" data-msg="Explain the tectonic activity in Guatemala">Tectonic Activity</div>
            <div class="suggestion" data-msg="What are the most dangerous fault lines in Guatemala?">Fault Lines</div>
            <div class="suggestion" data-msg="How does earthquake early warning work in Guatemala?">Early Warning</div>
            <div class="suggestion" data-msg="What building codes exist for earthquakes in Guatemala?">Building Codes</div>
        </div>
        
        <div class="chat-input">
            <input type="text" id="userInput" placeholder="Ask about earthquakes in Guatemala...">
            <button id="sendButton">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="22" y1="2" x2="11" y2="13"></line>
                    <polygon points="22 2 15 22 11 13 2 9 22 2"></polygon>
                </svg>
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const chatContainer = document.getElementById('chatContainer');
            const userInput = document.getElementById('userInput');
            const sendButton = document.getElementById('sendButton');
            const suggestions = document.querySelectorAll('.suggestion');
            
            // OpenAI API Configuration - CORREGIDA
            const API_KEY = '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';
            const API_URL = 'https://api.openai.com/v1/chat/completions';
            
            // Set initial time
            document.getElementById('initialTime').textContent = getCurrentTime();
            
            // Function to get current time
            function getCurrentTime() {
                const now = new Date();
                return `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            }
            
            // Function to add message to chat
            function addMessage(message, isUser = false) {
                const messageDiv = document.createElement('div');
                messageDiv.className = `message ${isUser ? 'user-message' : 'bot-message'}`;
                
                // Convert line breaks to HTML
                const formattedMessage = message.replace(/\n/g, '<br>');
                messageDiv.innerHTML = formattedMessage;
                
                const timestamp = document.createElement('div');
                timestamp.className = 'timestamp';
                timestamp.textContent = getCurrentTime();
                
                messageDiv.appendChild(timestamp);
                
                chatContainer.appendChild(messageDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // Function to show typing indicator
            function showTypingIndicator() {
                const typingDiv = document.createElement('div');
                typingDiv.className = 'typing-indicator';
                typingDiv.id = 'typingIndicator';
                
                for (let i = 0; i < 3; i++) {
                    const dot = document.createElement('span');
                    typingDiv.appendChild(dot);
                }
                
                chatContainer.appendChild(typingDiv);
                chatContainer.scrollTop = chatContainer.scrollHeight;
            }
            
            // Function to hide typing indicator
            function hideTypingIndicator() {
                const typingIndicator = document.getElementById('typingIndicator');
                if (typingIndicator) {
                    typingIndicator.remove();
                }
            }
            
            // Function to call OpenAI API with better error handling
            async function callOpenAI(message) {
                try {
                    const response = await fetch(API_URL, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${API_KEY}`
                        },
                        body: JSON.stringify({
                            model: 'gpt-3.5-turbo',
                            messages: [
                                {
                                    role: 'system',
                                    content: `You are an expert earthquake specialist focused specifically on Guatemala. Provide accurate, detailed information about:
                                    - Historical earthquakes in Guatemala
                                    - Safety measures and emergency protocols
                                    - Tectonic plates and fault lines in the region
                                    - Building codes and construction safety
                                    - Early warning systems
                                    - Emergency preparedness
                                    - Geological context of Guatemalan earthquakes
                                    - Recent seismic activity
                                    
                                    Always prioritize safety information. Format responses with clear sections and use bullet points when helpful. Keep responses informative but concise.`
                                },
                                {
                                    role: 'user',
                                    content: message
                                }
                            ],
                            max_tokens: 800,
                            temperature: 0.7
                        })
                    });
                    
                    if (!response.ok) {
                        const errorData = await response.json().catch(() => ({}));
                        throw new Error(`API error: ${response.status} - ${errorData.error?.message || 'Unknown error'}`);
                    }
                    
                    const data = await response.json();
                    return data.choices[0].message.content;
                    
                } catch (error) {
                    console.error('OpenAI API error:', error);
                    
                    // Provide more specific error messages
                    if (error.message.includes('401')) {
                        return `Authentication error: Please check your API key. The current key may be invalid or expired.`;
                    } else if (error.message.includes('429')) {
                        return `Rate limit exceeded: Please wait a moment before sending another message.`;
                    } else if (error.message.includes('500')) {
                        return `OpenAI server error: Please try again in a few moments.`;
                    } else if (error.message.includes('Network')) {
                        return `Network connection error: Please check your internet connection and try again.`;
                    } else {
                        return `I'm experiencing technical difficulties: ${error.message}. Please try again in a moment.`;
                    }
                }
            }
            
            // Function to process user message with fallback
            async function processUserMessage(message) {
                // Clear input
                userInput.value = '';
                userInput.disabled = true;
                sendButton.disabled = true;
                
                // Add user message to chat
                addMessage(message, true);
                
                // Show typing indicator
                showTypingIndicator();
                
                try {
                    // Get AI response
                    const response = await callOpenAI(message);
                    
                    // Hide typing indicator and show response
                    setTimeout(() => {
                        hideTypingIndicator();
                        addMessage(response);
                        userInput.disabled = false;
                        sendButton.disabled = false;
                        userInput.focus();
                    }, 500);
                    
                } catch (error) {
                    // Hide typing indicator and show error
                    setTimeout(() => {
                        hideTypingIndicator();
                        addMessage(`I encountered an unexpected error: ${error.message}. Please try again.`);
                        userInput.disabled = false;
                        sendButton.disabled = false;
                        userInput.focus();
                    }, 500);
                }
            }
            
            // Event for send button
            sendButton.addEventListener('click', function() {
                const message = userInput.value.trim();
                if (message) {
                    processUserMessage(message);
                }
            });
            
            // Event for Enter key
            userInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    const message = userInput.value.trim();
                    if (message) {
                        processUserMessage(message);
                    }
                }
            });
            
            // Events for suggestions
            suggestions.forEach(suggestion => {
                suggestion.addEventListener('click', function() {
                    const message = this.getAttribute('data-msg');
                    processUserMessage(message);
                });
            });
            
            // Focus input on page load
            userInput.focus();
            
            // Add welcome message with AI capabilities
            setTimeout(() => {
                addMessage("I'm connected to AI and ready to answer your questions about earthquakes in Guatemala. You can ask about historical events, safety procedures, tectonic activity, or anything else related to seismic activity in the region.");
            }, 1000);
        });
    </script>
</body>
</html>
